<div class="container">
  <div class="card card-custom">
    <div class="card-header flex-wrap border-0 pt-6 pb-0">
      <div class="card-title">
        <h3 class="card-label">
          Projects
          <span class="d-block text-muted pt-2 font-size-sm"
            >view projects</span
          >
        </h3>
      </div>
    </div>
    <div class="card-body can-view">
      <div class="mb-7">
        <div class="row align-items-center">
          <div class="col-lg-9 col-xl-8">
            <div class="row align-items-center">
              <div class="col-md-12 my-2 my-md-0">
                <div class="input-icon">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search..."
                    id="cb_datatable_search_query"
                  />
                  <span>
                    <i class="flaticon2-search-1 text-muted"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-xl-4 mt-5 mt-lg-0">
            <a
              href="javascript:void(0)"
              id="cb_datatable_reload"
              class="btn btn-light-primary px-6 font-weight-bold"
              >Reload</a
            >
          </div>
        </div>
      </div>

      <div
        class="datatable datatable-bordered datatable-head-custom"
        id="cb_datatable"
      ></div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="editContact"
  data-backdrop="static"
  tabindex="-1"
  role="dialog"
  aria-labelledby="staticBackdrop"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title contact-title" id="exampleModalLabel"></h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <i aria-hidden="true" class="ki ki-close"></i>
        </button>
      </div>
      <div class="modal-body" id="contactBody"></div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-light-primary font-weight-bold"
          data-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
	<div class="modal fade" id="viewProject" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title project-title"></h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<i aria-hidden="true" class="ki ki-close"></i>
					</button>
				</div>
				<div class="modal-body" id="project-body">
											<!--begin::Body-->
											<div class="card-body ">
												<!--begin::Section-->
												<div class="d-flex align-items-center">

													<!--end::Pic-->
													<!--begin::Info-->
													<div class="d-flex flex-column mr-auto">
														<!--begin: Title-->
														<a href="#" class="card-title text-hover-primary font-weight-bolder font-size-h5 text-dark mb-1 project-title"></a>

													</div>
													<!--end::Info-->

												</div>
												<!--end::Section-->
												<!--begin::Content-->
												<div class="d-flex flex-wrap mt-14">
													<div class="mr-12 d-flex flex-column mb-7">
														<span class="d-block font-weight-bold mb-4">Date Posted</span>
														<span class="btn btn-light-primary btn-sm font-weight-bold btn-upper btn-text project-date-posted"></span>
													</div>
													<div class="mr-12 d-flex flex-column mb-7">
														<span class="d-block font-weight-bold mb-4">Place</span>
														<span class="btn btn-light-danger btn-sm font-weight-bold btn-upper btn-text project-place"></span>
													</div>

												</div>
												<!--end::Content-->
												<!--begin::Text-->
                                                <div class="p-0 rounded px-10 py-15 d-flex align-items-center justify-content-center">
																<img src=""  class="mw-100 w-200px project-image" style="transform: scale(1.6);">
															</div>
												<p class="mb-7 mt-3 project-description"></p>
												<!--end::Text-->

											</div>
											<!--end::Body-->
											<!--begin::Footer-->
											<div class="card-footer d-flex align-items-center">
												<div class="d-flex">
													<div class="d-flex align-items-center mr-7">
														<span class="svg-icon svg-icon-gray-500">
															<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <rect x="0" y="0" width="24" height="24"/>
        <path d="M9,10 L9,19 L10.1525987,19.3841996 C11.3761964,19.7920655 12.6575468,20 13.9473319,20 L17.5405883,20 C18.9706314,20 20.2018758,18.990621 20.4823303,17.5883484 L21.231529,13.8423552 C21.5564648,12.217676 20.5028146,10.6372006 18.8781353,10.3122648 C18.6189212,10.260422 18.353992,10.2430672 18.0902299,10.2606513 L14.5,10.5 L14.8641964,6.49383981 C14.9326895,5.74041495 14.3774427,5.07411874 13.6240179,5.00562558 C13.5827848,5.00187712 13.5414031,5 13.5,5 L13.5,5 C12.5694044,5 11.7070439,5.48826024 11.2282564,6.28623939 L9,10 Z" fill="#000000"/>
        <rect fill="#000000" opacity="0.3" x="2" y="9" width="5" height="11" rx="1"/>
    </g>
</svg>
														</span>
														<a href="#!" class="font-weight-bolder text-primary ml-2 project-likes"></a>
													</div>
													<div class="d-flex align-items-center mr-7">
														<span class="svg-icon svg-icon-gray-500">

															<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
																	<rect x="0" y="0" width="24" height="24"></rect>
																	<path d="M16,15.6315789 L16,12 C16,10.3431458 14.6568542,9 13,9 L6.16183229,9 L6.16183229,5.52631579 C6.16183229,4.13107011 7.29290239,3 8.68814808,3 L20.4776218,3 C21.8728674,3 23.0039375,4.13107011 23.0039375,5.52631579 L23.0039375,13.1052632 L23.0206157,17.786793 C23.0215995,18.0629336 22.7985408,18.2875874 22.5224001,18.2885711 C22.3891754,18.2890457 22.2612702,18.2363324 22.1670655,18.1421277 L19.6565168,15.6315789 L16,15.6315789 Z" fill="#000000"></path>
																	<path d="M1.98505595,18 L1.98505595,13 C1.98505595,11.8954305 2.88048645,11 3.98505595,11 L11.9850559,11 C13.0896254,11 13.9850559,11.8954305 13.9850559,13 L13.9850559,18 C13.9850559,19.1045695 13.0896254,20 11.9850559,20 L4.10078614,20 L2.85693427,21.1905292 C2.65744295,21.3814685 2.34093638,21.3745358 2.14999706,21.1750444 C2.06092565,21.0819836 2.01120804,20.958136 2.01120804,20.8293182 L2.01120804,18.32426 C1.99400175,18.2187196 1.98505595,18.1104045 1.98505595,18 Z M6.5,14 C6.22385763,14 6,14.2238576 6,14.5 C6,14.7761424 6.22385763,15 6.5,15 L11.5,15 C11.7761424,15 12,14.7761424 12,14.5 C12,14.2238576 11.7761424,14 11.5,14 L6.5,14 Z M9.5,16 C9.22385763,16 9,16.2238576 9,16.5 C9,16.7761424 9.22385763,17 9.5,17 L11.5,17 C11.7761424,17 12,16.7761424 12,16.5 C12,16.2238576 11.7761424,16 11.5,16 L9.5,16 Z" fill="#000000" opacity="0.3"></path>
																</g>
															</svg>
															<!--end::Svg Icon-->
														</span>
														<a href="#" class="font-weight-bolder text-primary ml-2 project-comments"></a>
													</div>
												</div>

											</div>
											<!--end::Footer-->

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
<script type="text/javascript">
  "use strict";
  // Class definition

  var CBCustomerNotifications = (function () {
    // Private functions
    var notifications = function () {
      var datatable = $("#cb_datatable").KTDatatable({
        // datasource definition
        data: {
          type: "remote",
          source: `https://api.rennintech.com/mp-operations/list-mp-projects-cust/${user_details.system_id_for_user}/`,
          pageSize: 10,
        },
        layout: {
          scroll: false,
          footer: false,
        },
        sortable: true,

        pagination: true,

        search: {
          input: $("#cb_datatable_search_query"),
          key: "generalSearch",
        },

        // columns definition
        columns: [
          {
            field: "id",
            title: "#",
            sortable: "asc",
            width: 30,
            type: "number",
            selector: false,
            textAlign: "center",
          },
          {
            field: "name",
            title: "Name",
          },
          {
            field: "place",
            title: "Place",
          },
          {
            field: "date_posted",
            title: "Date",
            template: (row) => {
              return `${formatAMPM(row.date_posted)}`;
            },
          },
            {
                field: 'description',
                title: 'Action',
                template:(row => {
                    return `<button  data-id="${row.id}" onclick="viewProject(this)" class="btn btn-secondary">
    <i class="flaticon-eye"></i> View Project
</button>`
                })
            },
        ],
      });

      $("#cb_datatable_reload").on("click", function () {
        datatable.reload();
      });
    };

    return {
      // public functions
      init: function () {
        notifications();
      },
    };
  })();

  jQuery(document).ready(function () {
    CBCustomerNotifications.init();
  });
  function viewProject($this) {
       KTApp.blockPage({
          overlayColor: "#000000",
          state: "primary",
          message: "Please Wait...",
        });
      var project_id = $($this).data('id');

      $.get(`https://api.rennintech.com/mp-operations/get-project-detail/${project_id}/`, (data)=> {

          if (data.status ===200) {
                var data = data.data;
              var time = moment(data.date_posted).format('DD MMM, YY');
              $('.project-title').text(data.name);
              $('.project-comments').text(`${data.comments.length} comments`);
              $('.project-likes').text(`${data.likes.length} likes`);
              $('.project-place').text(data.place);
              $('.project-description').html(data.description);
              $('.project-date-posted').text(time);
              console.log('datame',data.media);
              if(data.media) {
                  $('.project-image').attr('src',`https://api.rennintech.com${data.media}`).show();
              }else {
                  $('.project-image').hide();
              }
              $("#viewProject").modal('show');

KTApp.unblockPage();
          }else {
              swal
          .fire({
            text: `An error occurred and that is all we know`,
            icon: "error",
            buttonsStyling: false,
            confirmButtonText: "Ok, got it!",
            customClass: {
              confirmButton: "btn font-weight-bold btn-light-danger",
            },
          })
          .then(() => KTApp.unblockPage());
          }
      })
  }
</script>
